<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <button class="theme-toggle" id="themeBtn">üåô Dark</button>

  <div class="card">
    <div class="ring"></div>
    <h1 id="title">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‚Ä¶</h1>
    <p id="subtitle">‡∏ñ‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏£‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
    <div class="bar"><i></i></div>
    <div class="list" id="status"></div>
    <div class="actions">
      <button class="btn" id="skip">‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
      <button class="btn" id="retry" style="display:none;">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
    </div>
    <div class="muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
  </div>

  <audio id="beep" src="assets/beep_short.ogg" preload="auto"></audio>

  <script>
    const statusEl=document.getElementById('status');
    const btnSkip=document.getElementById('skip');
    const btnRetry=document.getElementById('retry');
    const beep=document.getElementById('beep');
    const titleEl=document.getElementById('title');
    const subtitleEl=document.getElementById('subtitle');

    let leftPage=false;
    let countdownTimer;
    const TIMEOUT_MS=5000;

    // ‡∏≠‡πà‡∏≤‡∏ô index (i) ‡∏à‡∏≤‡∏Å URL
    const params=new URLSearchParams(window.location.search);
    let currentIndex=parseInt(params.get("i") || "0",10);

    window.addEventListener('pagehide',()=>leftPage=true,{once:true});
    document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='hidden')leftPage=true;});

    function log(msg){
      const line=document.createElement('div');
      line.innerHTML=msg;
      statusEl.appendChild(line);
      statusEl.scrollTop=statusEl.scrollHeight;
    }
    function playBeep(){beep.currentTime=0;beep.play().catch(()=>{});}

    async function tryLink(i){
      const res=await fetch("links.json");
      const data=await res.json();
      const URLS=data.urls;

      if(i>=URLS.length){
        log('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        titleEl.textContent='‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        subtitleEl.textContent='‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
        btnRetry.style.display='inline-block';
        btnSkip.style.display='none';
        return;
      }
      const url=URLS[i];
      log(`‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏≠‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå ${i+1}... <a href="${url}" target="_blank">(‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏á)</a>`);
      playBeep();

      let secs=TIMEOUT_MS/1000;
      titleEl.textContent=`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‚Ä¶ (${secs}s)`;
      clearInterval(countdownTimer);
      countdownTimer=setInterval(()=>{
        secs--;
        if(secs>=0) titleEl.textContent=`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‚Ä¶ (${secs}s)`;
      },1000);

      const timer=setTimeout(()=>{
        clearInterval(countdownTimer);
        if(!leftPage){
          log(`‚ö†Ô∏è ‡∏•‡∏¥‡∏á‡∏Å‡πå ${i+1} ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°`);
          tryLink(i+1);
        }
      },TIMEOUT_MS);

      try{window.location.href=url;}catch(e){}

      btnSkip.onclick=()=>{
        clearTimeout(timer);
        clearInterval(countdownTimer);
        if(!leftPage){
          log('‚è© ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ');
          playBeep();
          tryLink(i+1);
        }
      };
    }

    btnRetry.onclick=()=>{
      statusEl.innerHTML='';
      leftPage=false;
      btnRetry.style.display='none';
      btnSkip.style.display='inline-block';
      tryLink(0);
    };

    // Start
    tryLink(currentIndex);

    // Theme toggle
    const themeBtn=document.getElementById('themeBtn');
    themeBtn.addEventListener('click',()=>{
      document.body.classList.toggle('light');
      themeBtn.textContent=document.body.classList.contains('light')?'üåû Light':'üåô Dark';
    });
  </script>
</body>
</html>
